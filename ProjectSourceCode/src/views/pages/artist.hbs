<title>Display One Artist Page</title>
{{> message }}

<div class="container mt-3">
    <div class="row">
      <div class="col-md-2">
        <!-- Artist Thumbnail on Left 1/3 of screen -->
        <img src="{{artist.thumbnail}}" class="img-fluid" alt="Artist">
      </div>
      <div class="col-md-8">
        <!-- Artist Name and Details on Right 2/3 of screen-->
        <h2 class="text-centered" id="artistInfo" data-artist-name="{{artist.name}}">{{artist.name}}</h2>
        <div class="container-fluid" id="links_container">
          {{#if (find followedArtists artist.id)}}
            <button type="button" id="unfollow_button" class="btn btn-outline-danger" data-artist-id="{{artist.id}}">Unfollow Artist</button>
          {{else}}
            <button type="button" id="follow_button" class="btn btn-outline-danger" data-artist-id="{{artist.id}}">Follow Artist</button>
          {{/if}}
          <a class="btn btn-outline-danger" href="/followedArtists">Your Follow List</a>
        </div>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col">
        <!-- Artist Bio -->
          <div id="biography-container">
            <!-- Biography content will be displayed here -->   
            {{{artist.biography}}}
          </div>
      </div>
    </div>
  </div>

  {{!-- Artworks by the artist  --}}
  <div class="container mt-3 mb-3" id="artworkContainer">
    <h3>Related Artworks</h3>
    <div class="row" id="artworkRow">
      <!--artworks are appended here! :) -->
    </div>
  </div>

  <!-- Other Artists similar to artists -->
  <div class="container mt-3 mb-3" id="similarArtistsContainer">
    <h3>Other Artists Like This</h3>
      <div class="row" id="similarArtistsRow">
        <!-- Similar artist items will be appended here -->
    </div>
  </div>

<script src = "/resources/js/script.js" type="text/javascript"></script>
  <script>
    $(document).ready(function() {
      displayRelatedArtists('{{artist.name}}');
      fetchAndDisplayArtwork('{{artist.name}}');
    });
  </script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Event delegation for clicks on dynamically added artist cards
    document.addEventListener('click', (event) => {
      if (event.target.matches('.artist-card, .artist-card *')) {
        const artistId = event.target.closest('.artist-card').dataset.artistId;
        if (artistId) {
            window.location.href = `/artist/${artistId}`; // Redirect to artist page
        }
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      let container = document.querySelector('#artistContainer');
      if (container) {
        container.addEventListener('click', (event) => {
          const artistID = event.target.closest('.artist-card').dataset.artistid;
          console.log('Artist ID: ' + artistID);
          if (artistID) {
            window.location.href = `/artist/${artistID}`;
          }
        });
      } else {
        console.error('Container not found in the DOM.');
      }
    });

    document.addEventListener('click', (event) => {
    if (event.target.matches('#follow_button')) {
      // Prevent the default button action
      if (event.target.matches('#follow_button, #unfollow_button')) {
        event.stopPropagation();
      }
      event.preventDefault();

      // Get the artist ID from the artist object
      const artistId = $('#follow_button').attr('data-artist-id');
      console.log("artistID-client: " + artistId);
      const artistName= $('#artistInfo').attr('data-artist-name');
      // Make an AJAX POST request to the server
      $.ajax({
        url: '/follow', // Your server endpoint that handles the POST request
        type: 'POST',
        data: { artistId: artistId , artistName: artistName}, // Data you want to send to the server
        success: function(response) {
          // Handle success (e.g., update the button text to 'Following', display a message, etc.)
          console.log('Follow successful:', response);
          window.location.reload();
        },
        error: function(xhr, status, error) {
          // Handle error
          console.log('Follow failed:', error);
        }
      });


    // TODO Disable follow_button
    event.target.disabled = true;
    event.target.classList.add('disabled');
    event.target.innerHTML = 'Following!';
    }
    });
      
    /*{{!-- document.addEventListener('click', (events) =>{    
    if (event.target.matches('#unfollow_button')) {
      // Prevent the default button action
      event.preventDefault();

      // Get the artist ID from the artist object
      const artistId = $('#unfollow_button').attr('data-artist-id');
      console.log("artistID-client: " + artistId);
      const artistName= $('#artistInfo').attr('data-artist-name');
      // Make an AJAX POST request to the server
      $.ajax({
        url: '/unfollow', // Your server endpoint that handles the POST request
        type: 'POST',
        data: { artistId: artistId , artistName: artistName}, // Data you want to send to the server
        success: function(response) {
          // Handle success (e.g., update the button text to 'Following', display a message, etc.)
          console.log('Unfollow successful:', response);
          window.location.reload();
        },
        error: function(xhr, status, error) {
          // Handle error
          console.log('Unfollow failed:', error);
        }
      });
    }
  }); --}}*/
});
</script>